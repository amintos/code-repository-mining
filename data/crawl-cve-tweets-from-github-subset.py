#!/usr/bin/env python3

import psycopg2
import subprocess
import config

query="SELECT DISTINCT regexp_matches(message, 'CVE-[0-9]{3,4}-[0-9]{3,7}', 'g') as cve FROM view_commit_data_search_for_CVE"
postgresConnection = psycopg2.connect(dbname=config.postgresql.dbname,
                                      user=config.postgresql.user,
                                      password=config.postgresql.password)

cursor = connection.cursor()
cursor.execute(query)
cvelist = []

for row in cursor:
	cvelist.append('"' + row[0][0] + '"')

# bypass maximum parameter length
for cve in cvelist:
	subprocess.call(["scrapy", "crawl", "TweetScraper", "-a", "query="+cve])
